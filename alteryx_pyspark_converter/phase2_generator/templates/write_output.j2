# =============================================================================
# WRITE OUTPUT
# =============================================================================

{% if output_columns %}
# Select final output columns and write
df_output = df_result.select(
{% for col in output_columns %}
    "{{ col }}"{{ "," if not loop.last else "" }}
{% endfor %}
)
{% else %}
df_output = df_result
{% endif %}

df_output.write.mode("overwrite").saveAsTable("{{ output_table }}")
